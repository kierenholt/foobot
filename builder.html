<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8" />
  <title>FOOBOT</title>
  <script src="acorn.js"></script>
  <script src="phaser.js"></script>
  <script src="foobot.js"></script>
  
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js" type="text/javascript"></script> 
  <script src="skulpt/dist/skulpt.min.js" type="text/javascript"></script> 
  <script src="skulpt/dist/skulpt-stdlib.js" type="text/javascript"></script> 
  
  <link rel="stylesheet" href="style.css">
</head>

<body onload="ready()">
  
<div id="gameDiv">
  <p>Visit this page to solve: <a id="levelMapSpan" href="#">#</a></p>
  <!--- CANVAS IS CREATED HERE --->
</div> <!-- END OF GAMEDIV -->


<div id="settings">    
    
  <p>width</p>
  <input class="slider" id="setWidthSlider" type="range" step="1" min="1" max="8" value="1"></input>
  <p>height</p>
  <input class="slider" id="setHeightSlider" type="range" step="1" min="1" max="8" value="1"></input>
  <p>no. grids</p>
  <input class="slider" id="setNumGridsSlider" type="range" step="1" min="1" max="4" value="1"></input>
  <p>char limit <span id="charLimitDescription">OFF</span></p>
  <input class="slider" id="setCharLimitSlider" type="range" step="10" min="0" max="630" value="0"></input>

</div>


<div id="buttons">
  <div id="left">
    <textarea id="codeInput">ahead();</textarea>
    <select id="languageSelect">
      <option selected>javascript</option>
      <option>python</option>
    </select>
    <p><span id="characterCountSpan">#</span>&nbsp;characters</p>
    <p><a target="_blank" href="help.html">Click here for help</a></p>
  </div>
  <div id="right">
    <img id="playButton" src="assets/play.png" title="play"></img>
    <img id="fastPlayButton" src="assets/fastplay.png" title="fastplay"></img>
    <img id="resetButton" src="assets/reset-small.png" title="reset"></img>
    <span id="timerSpan"></span>
  </div>
</div>

  <script>

    function ready() {
      document.getElementById("levelMapSpan").href = "solver.html" + window.location.search;
      document.getElementById("levelMapSpan").innerHTML = "solver.html" + window.location.search;      

      let setWidthSlider = document.getElementById("setWidthSlider");
      let setHeightSlider = document.getElementById("setHeightSlider");
      let setNumGridsSlider = document.getElementById("setNumGridsSlider");
      let setCharLimitSlider = document.getElementById("setCharLimitSlider");
      let characterCountSpan = document.getElementById("characterCountSpan");
      let codeInput = document.getElementById("codeInput");

      let mapAsString = window.location.search.substring(1);
      let config = null;
      
      if (mapAsString && mapAsString.length > 0) { //from mapstring
            config = Config.fromBase64(mapAsString,"levelMapSpan");
            config.updateConfigSpan();
        }
        else { //no mapstring
            config = Config.createDefault("levelMapSpan");
            config.updateConfigSpan();
        }
        
        setWidthSlider.value = config.configGrids[0].width;
        setHeightSlider.value = config.configGrids[0].height;
        setNumGridsSlider.value = config.configGrids.length;
        setCharLimitSlider.value = config.charLimit;

        setWidthSlider.oninput = (event) => {
          config.configGrids.forEach(g => g.setWidth(Number(this.setWidthSlider.value)));
        };

        setHeightSlider.oninput = (event) => {
          config.configGrids.forEach(g => g.setHeight(Number(this.setHeightSlider.value)));
        }
        
        setNumGridsSlider.oninput = (event) => {
          config.setNumGrids(this.setNumGridsSlider.value);
        }


        setCharLimitSlider.oninput = (e) => {
          let value = document.getElementById("setCharLimitSlider").value;
          document.getElementById("charLimitDescription").innerText = value == 0 ? "OFF" : value;
          config.setCharLimit(value);
        }
        let value = document.getElementById("setCharLimitSlider").value;
        document.getElementById("charLimitDescription").innerText = value == 0 ? "OFF" : value;

        codeInput.oninput = (e) => {
          characterCountSpan.innerText = codeInput.value.length;
        }
        characterCountSpan.innerText = codeInput.value.length;

    
      //game last
      var game = new fooBotBuilder("gameDiv",
        "codeInput",
        "playButton",
        "resetButton",
        "fastPlayButton",
        "languageSelect",
        config);
    }
    
    
  </script>

</body>

</html>